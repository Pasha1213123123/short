–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é Flutter Shorts
1. –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—É—é –ª–µ–Ω—Ç—É –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–∏–¥–µ–æ (–∞–Ω–∞–ª–æ–≥ YouTube Shorts –∏–ª–∏ TikTok).
–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ —Å YouTube.

–ü—Ä–æ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏–µ —Å–≤–∞–π–ø–∞–º–∏ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑.

–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –¥–ª—è –ø–ª–∞–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∫–∞–∑ –º–µ–∂—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–π —Ä–µ–∫–ª–∞–º—ã —á–µ—Ä–µ–∑ –∑–∞–¥–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª.

–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:

UI: Flutter, PageView.builder.

–í–∏–¥–µ–æ: youtube_player_flutter.

–°–æ—Å—Ç–æ—è–Ω–∏—è: flutter_riverpod.

–†–µ–∫–ª–∞–º–∞: google_mobile_ads.

–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç—ã: firebase_analytics, firebase_crashlytics.

2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
üñº ShortsViewer (–≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω)

–¢–∏–ø: StatefulWidget.

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–π –ª–µ–Ω—Ç–æ–π.

–§—É–Ω–∫—Ü–∏–∏:

–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑ PageView.builder.

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–∞—É–∑–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ).

–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–µ–æ –ø—Ä–∏ —Å–≤–∞–π–ø–∞—Ö (_onPageChanged).

–ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–æ–∫–∞–∑ —Ä–µ–∫–ª–∞–º—ã.

üé¨ ShortsPlayerPage (—ç–∫—Ä–∞–Ω –æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ)

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–∏–¥–µ–æ.

–§—É–Ω–∫—Ü–∏–∏:

–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫: —Å–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–µ–≤—å—é (Image.network), –∞ –∑–∞—Ç–µ–º –Ω–µ–∑–∞–º–µ—Ç–Ω–æ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø–ª–µ–µ—Ä.

–ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è AspectRatio + FittedBox (BoxFit.cover).

–ñ–µ—Å—Ç—ã: GestureDetector –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ –Ω–∞ –ø–∞—É–∑—É –∏–ª–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ.

üíæ VideoCacheManager (–∫—ç—à –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤)

–ü—Ä–æ–±–ª–µ–º–∞: —Å–æ–∑–¥–∞–Ω–∏–µ YoutubePlayerController –¥–æ—Ä–æ–≥–æ –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º.

–†–µ—à–µ–Ω–∏–µ:

–•—Ä–∞–Ω–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –≤ Map.

–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à: –µ—Å–ª–∏ –µ—Å—Ç—å ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º, –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë–º.

–î–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è LRU (Least Recently Used): —É–¥–∞–ª—è–µ—Ç—Å—è —Å–∞–º—ã–π "—Å—Ç–∞—Ä—ã–π" –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä.

‚è∏ VideoPlayerStateManager (–º–µ–Ω–µ–¥–∂–µ—Ä —Ä–µ–∫–ª–∞–º—ã)

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≤–∏–¥–µ–æ –≤–æ –≤—Ä–µ–º—è —Ä–µ–∫–ª–∞–º—ã.

–ú–µ—Ç–æ–¥—ã:

pauseForAd() ‚Äî –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤–∏–¥–µ–æ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º —Ä–µ–∫–ª–∞–º—ã.

resetAdState() ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Ä–µ–∫–ª–∞–º—ã.

3. –ö–ª—é—á–µ–≤—ã–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ—Ç–æ–∫–∏
‚ñ∂ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–µ–æ (_onPageChanged)

–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –≤–∏–¥–µ–æ.

–û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ (_currentPage, —Å—á—ë—Ç—á–∏–∫ _videosWatched).

–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∫–ª–∞–º—É:

–ï—Å–ª–∏ –ø–æ—Ä–∞ (_videosWatched % 3 == 0) ‚Üí –∑–∞–ø—É—Å–∫–∞–µ–º _showInterstitialAd() –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

–ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –±–µ—Ä—ë–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏–∑ –∫—ç—à–∞ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –≤–∏–¥–µ–æ.

üì¢ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ä–µ–∫–ª–∞–º—ã

–ö–æ–≥–¥–∞ —Ä–µ–∫–ª–∞–º–∞ –∑–∞–∫—Ä—ã—Ç–∞ (onAdDismissedFullScreenContent), –Ω–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä.

–í—ã–∑—ã–≤–∞–µ–º _playVideoWhenReady, —á—Ç–æ–±—ã –≤–∏–¥–µ–æ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞.

üîÑ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º –Ω–∞–∑–∞–¥

–ï—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –≤–∏–¥–µ–æ ‚Äî –æ–Ω–æ –ø–æ–π–¥—ë—Ç —Å —Å–µ—Ä–µ–¥–∏–Ω—ã.

–ß—Ç–æ–±—ã —ç—Ç–æ–≥–æ –∏–∑–±–µ–∂–∞—Ç—å, –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∑–∞–ø—É—Å–∫–æ–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:

controller.seekTo(Duration.zero);


–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ª—é–±–æ–µ –≤–∏–¥–µ–æ –≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞.

4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ –ø–æ –∫–ª–∞—Å—Å–∞–º
main.dart

VideoPlayerStateManager ‚Äî —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∫–ª–∞–º–æ–π –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è.

ShortModel ‚Äî –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ.

VideoCacheManager ‚Äî LRU-–∫—ç—à –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤.

MemoryMonitor ‚Äî –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å (–º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª—ë–Ω).

_ShortsViewerState

–£–ø—Ä–∞–≤–ª—è–µ—Ç:

PageView.

–ö—ç—à–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤.

–ü–æ–∫–∞–∑–æ–º —Ä–µ–∫–ª–∞–º—ã.

–û—Å–Ω–æ–≤–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:

_onPageChanged() ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–µ–æ.

_playVideoWhenReady() ‚Äî –∑–∞–ø—É—Å–∫ –≤–∏–¥–µ–æ —Å –Ω—É–ª—è.

_getControllerForIndex() ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ (–∏–∑ –∫—ç—à–∞ –∏–ª–∏ –Ω–æ–≤—ã–π).

_loadInterstitialAd(), _showInterstitialAd() ‚Äî –ª–æ–≥–∏–∫–∞ —Ä–µ–∫–ª–∞–º—ã.

_ShortsPlayerPageState

build() ‚Äî –≤–µ—Ä—Å—Ç–∫–∞ (–≤–∏–¥–µ–æ + –ø—Ä–µ–≤—å—é + –∏–∫–æ–Ω–∫–∏ –ø–∞—É–∑—ã).

_playerStateListener() ‚Äî —É–±–∏—Ä–∞–µ—Ç –ø—Ä–µ–≤—å—é, –∫–æ–≥–¥–∞ –≤–∏–¥–µ–æ —Ä–µ–∞–ª—å–Ω–æ —Å—Ç–∞—Ä—Ç—É–µ—Ç.

_togglePlaying() ‚Äî –ø–∞—É–∑–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –Ω–∞–∂–∞—Ç–∏—é.